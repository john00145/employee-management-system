<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit Employee</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!--    <script>-->
<!--        // Function to show loading alert-->
<!--        function showLoadingAlert() {-->
<!--            Swal.fire({-->
<!--                title: 'Saving...',-->
<!--                html: 'Please wait while we save the employee data.',-->
<!--                allowEscapeKey: false,-->
<!--                allowOutsideClick: false,-->
<!--                didOpen: () => {-->
<!--                    Swal.showLoading();-->
<!--                }-->
<!--            });-->
<!--        }-->

<!--        // Function to show success alert after saving-->
<!--        function showSuccessAlert() {-->
<!--            Swal.fire({-->
<!--                icon: 'success',-->
<!--                title: 'Employee has been saved!',-->
<!--                showConfirmButton: false,-->
<!--                timer: 3000, // Set the timer to 3 seconds-->
<!--                timerProgressBar: true, // Show a progress bar-->
<!--            }).then(() => {-->
<!--                // Redirect to employee list after success alert-->
<!--                window.location.href = '/employee';-->
<!--            });-->
<!--        }-->

<!--        // Function to handle form submission-->
<!--        function handleFormSubmit(event) {-->
<!--            event.preventDefault(); // Prevent default form submission-->
<!--            showLoadingAlert(); // Show loading alert-->

<!--            // Submit the form using AJAX-->
<!--            const form = event.target; // Get the form that was submitted-->
<!--            const formData = new FormData(form); // Create a FormData object-->

<!--            // Make an AJAX request to submit the form-->
<!--            fetch(form.action, {-->
<!--                method: form.method,-->
<!--                body: formData-->
<!--            })-->
<!--                .then(response => {-->
<!--                    if (response.ok) {-->
<!--                        // Show success alert if response is OK-->
<!--                        showSuccessAlert();-->
<!--                    } else {-->
<!--                        // Handle error if needed (optional)-->
<!--                        Swal.fire('Error!', 'There was a problem saving the employee data.', 'error');-->
<!--                    }-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    console.error('Error:', error);-->
<!--                    Swal.fire('Error!', 'There was a problem saving the employee data.', 'error');-->
<!--                });-->
<!--        }-->
<!--    </script>-->

</head>
<body>
<div class="container my-5">
    <h1>Edit Employee</h1>
    <form th:action="@{/update-employee}" th:object="${employee}" method="post" id="editForm">
        <input type="hidden" th:field="*{id}"/> <!-- Hidden field for employee ID -->

        <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" id="firstName" th:field="*{firstName}" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" id="lastName" th:field="*{lastName}" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" th:field="*{email}" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="department" class="form-label">Department</label>
            <input type="text" id="department" th:field="*{department}" class="form-control" required>
        </div>

        <button type="submit" class="btn btn-warning">Update Employee</button>
        <a href="/employee" class="btn btn-secondary">Back to list</a>
    </form>
</div>

<!--<script>-->
<!--    let isEditing = false; // Track the editing state-->

<!--    // Function to show loading alert with progress bar-->
<!--    function showLoadingAlert() {-->
<!--        Swal.fire({-->
<!--            title: 'Updating...',-->
<!--            html: '<div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 100%;"></div></div>',-->
<!--            allowEscapeKey: false,-->
<!--            allowOutsideClick: false,-->
<!--            didOpen: () => {-->
<!--                Swal.showLoading();-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--    // Function to show success alert after editing-->
<!--    function showSuccessAlert() {-->
<!--        Swal.fire({-->
<!--            icon: 'success',-->
<!--            title: 'Employee has been updated successfully!',-->
<!--            showConfirmButton: false,-->
<!--            timer: 3000, // Set the timer to 3 seconds-->
<!--            backdrop: `-->
<!--                rgba(0, 255, 0, 0.5) // Success green backdrop-->
<!--            `-->
<!--        }).then(() => {-->
<!--            // Redirect to the employee list after success-->
<!--            window.location.href = '/employee'; // Redirect to the employee list-->
<!--        });-->
<!--    }-->

<!--    // Function to handle form submission-->
<!--    function handleFormSubmit(event) {-->
<!--        event.preventDefault(); // Prevent default form submission-->
<!--        showLoadingAlert(); // Show loading alert-->

<!--        // Submit the form using AJAX-->
<!--        const form = event.target; // Get the form that was submitted-->
<!--        const formData = new FormData(form); // Create a FormData object-->

<!--        // Make an AJAX request to submit the form-->
<!--        fetch(form.action, {-->
<!--            method: form.method,-->
<!--            body: formData-->
<!--        })-->
<!--            .then(response => {-->
<!--                if (response.ok) {-->
<!--                    // Show success alert if response is OK-->
<!--                    showSuccessAlert();-->
<!--                } else {-->
<!--                    // Handle error if needed-->
<!--                    Swal.fire('Error!', 'There was a problem saving the employee data.', 'error');-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error('Error:', error);-->
<!--                Swal.fire('Error!', 'There was a problem saving the employee data.', 'error');-->
<!--            });-->
<!--    }-->

<!--    // Function to handle edit button click-->
<!--    document.getElementById('editButton').addEventListener('click', function () {-->
<!--        const firstNameInput = document.getElementById('firstName');-->
<!--        const lastNameInput = document.getElementById('lastName');-->
<!--        const emailInput = document.getElementById('email');-->
<!--        const departmentInput = document.getElementById('department');-->

<!--        // Toggle editing state-->
<!--        if (!isEditing) {-->
<!--            firstNameInput.disabled = false;-->
<!--            lastNameInput.disabled = false;-->
<!--            emailInput.disabled = false;-->
<!--            departmentInput.disabled = false;-->

<!--            this.textContent = 'Update Employee'; // Change button text-->
<!--            isEditing = true; // Set editing mode-->
<!--        } else {-->
<!--            // Confirm update on button click-->
<!--            Swal.fire({-->
<!--                title: 'Are you sure you want to update this employee?',-->
<!--                text: "You can still cancel if you want.",-->
<!--                icon: 'warning',-->
<!--                showCancelButton: true,-->
<!--                confirmButtonText: 'Yes, update it!',-->
<!--                cancelButtonText: 'No, cancel!'-->
<!--            }).then((result) => {-->
<!--                if (result.isConfirmed) {-->
<!--                    handleFormSubmit(event); // Call form submission function-->
<!--                }-->
<!--            });-->
<!--        }-->
<!--    });-->
<!--</script>-->

<script>
    // Function to handle form submission and show progress
    function handleFormSubmit(event) {
        event.preventDefault(); // Prevent default form submission

        Swal.fire({
            title: 'Updating...',
            html: '<div class="progress"><div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 0%;"></div></div>',
            allowEscapeKey: false,
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => {
                Swal.showLoading();
                let progressBar = document.getElementById("progress-bar");
                let width = 0;

                // Simulate progress incrementally
                let interval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(interval);
                        Swal.fire({
                            icon: 'success',
                            title: 'Employee has been updated successfully!',
                            showConfirmButton: false,
                            timer: 2000
                        }).then(() => {
                            // Redirect to the employee list after success alert
                            event.target.submit(); // Submits the form after showing the success alert
                        });
                    } else {
                        width += 10; // Increase progress by 10%
                        progressBar.style.width = width + '%';
                    }
                }, 200); // Update every 200ms for smoother progress
            }
        });
    }
</script>

</body>
</html>
